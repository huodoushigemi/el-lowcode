<!DOCTYPE html>
<html class="sl-theme-dark mdui-theme-auto dark">
  <head>
    <style>
      html, body, .Page { width: 100%; height: 100%; }
      body { margin: 0; }
      .Page { overflow: auto; }
      * { box-sizing: border-box; }
    </style>

    <!-- 共享 Vue 内存，以便实现数据响应 -->
    <script>
      if (window.parent) window.Vue = window.parent.Vue
    </script>



    <!-- 解决 iframe 不触发事件 -->
    <script type="module">
      import { useEventListener } from '@vueuse/core'
      import { pick } from '@el-lowcode/utils'

      if (window.parent) {
        document.addEventListener('wheel', e => {
          e.preventDefault()
          e.stopPropagation()
          
          const rect = frameElement.getBoundingClientRect()
          const x = e.x + rect.x, y = e.y + rect.y

          const event = new WheelEvent(e.type, {
            ...pick(e, [
              'deltaMode', 'deltaX', 'deltaY', 'deltaZ',
              'button', 'buttons',
              'screenX', 'screenY',
              'detail', 'which',
              'altKey', 'ctrlKey', 'metaKey', 'shiftKey',
              // 'modifierAltGraph', 'modifierCapsLock', 'modifierFn', 'modifierFnLock', 'modifierHyper', 'modifierNumLock', 'modifierScrollLock', 'modifierSuper', 'modifierSymbol', 'modifierSymbolLock',
              'bubbles', 'cancelable', 'composed'
            ]),
            // view: parent,
            clientX: x, clientY: y,
          })
          
          frameElement.dispatchEvent(event)
        }, { passive: false, capture: true })

        useEventListener(['mousedown', 'mousemove', 'mouseup'], e => {
          const rect = frameElement.getBoundingClientRect()
          frameElement.dispatchEvent(new MouseEvent(e.type, {
            ...pick(e, [
              'button', 'buttons', 'clientX', 'clientY', 'movementX', 'movementY', 'screenX', 'screenY',
              'altKey', 'ctrlKey', 'metaKey', 'shiftKey',
              'detail', 'which',
              'bubbles', 'cancelable', 'composed'
            ]),
            clientX: e.x + rect.x, clientY: e.y + rect.y,
          }))
        })

        useEventListener(['keypress', 'keydown', 'keyup'], e => {
          frameElement.dispatchEvent(new KeyboardEvent(e.type, pick(e, [
            'code', 'isComposing', 'key', 'location', 'repeat',
            'detail', 'which',
            'bubbles', 'cancelable', 'composed'
          ])))
        })
      }
    </script>

    
  
    <!-- 渲染 JSON -->
    <script type="module">
      import { createApp, h } from 'vue'
      import ElLowcode, { ConfigProvider } from 'el-lowcode'
      import DragBox from './drag-box2.vue'

      const app = createApp({
        provide: {
          designerCtx
        },
        render: () => [
          h(ConfigProvider, designerCtx.root, () => [
            h(DragBox, { el: designerCtx.root })
          ])
        ]
      })

      app.use(ElLowcode)
      app.mount(document.body)
    </script>
  </head>
  <body>
    <!--  -->
  </body>
</html>